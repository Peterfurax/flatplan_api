"use strict";function errEnd(o,t){t.status(400).json({err:o})}function capturePut(o,t){t.json(o.params)}var express=require("express"),app=express(),bodyParser=require("body-parser"),dataFile=require("./provider/data"),lib=require("./lib/lib"),data=dataFile,port=process.env.PORT||8e3,router=express.Router();app.use(bodyParser.urlencoded({extended:!0})),app.disable("x-powered-by"),app.use(bodyParser.json()),app.set("json spaces",2),router.route("/").get(function(o,t){t.json({message:"Welcome on flatplan_api !"})}),router.route("/produit/").get(function(o,t){t.json(data)}),router.route("/produit/:produit").get(function(o,t){lib.productIdx(o.params.produit).then(function(o){t.json(data[o])}).catch(function(o){return errEnd(o,t)})}).put(function(o,t){return capturePut(o,t)}),router.route("/produit/:produit/parution/").get(function(o,t){lib.productIdx(o.params.produit).then(function(o){t.json(data[o].parution)}).catch(function(o){return errEnd(o,t)})}),router.route("/produit/:produit/parution/:parution").get(function(o,t){lib.productParution(o).then(function(o){t.json(data[o.productIdx].parution[o.parutionIdx])}).catch(function(o){errEnd(o,t)})}).put(function(o,t){return capturePut(o,t)}),router.route("/produit/:produit/parution/:parution/folio").get(function(o,t){lib.productParution(o).then(function(o){t.json(data[o.productIdx].parution[o.parutionIdx].folio)}).catch(function(o){errEnd(o,t)})}),router.route("/produit/:produit/parution/:parution/folio/:folio").get(function(o,t){lib.productParutionFolio(o).then(function(o){t.json(data[o.productIdx].parution[o.parutionIdx].folio[o.folioIdx])}).catch(function(o){errEnd(o,t)})}).put(function(o,t){lib.productParutionFolio(o).then(function(r){data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx].page=o.params.folio,t.json(data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx])}).catch(function(o){errEnd(o)})}),router.route("/produit/:produit/parution/:parution/folio/:folio/status").get(function(o,t){lib.productParutionFolio(o).then(function(o){t.json(data[o.productIdx].parution[o.parutionIdx].folio[o.folioIdx].status)}).catch(function(o){errEnd(o,t)})}),router.route("/produit/:produit/parution/:parution/folio/:folio/status/:status").put(function(o,t){lib.productParutionFolio(o).then(function(r){data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx].status=o.params.status,t.json(data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx].status)}).catch(function(o){errEnd(o)})}),app.use("/api",router),app.listen(port),module.exports=app;