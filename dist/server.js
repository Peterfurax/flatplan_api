"use strict";function errEnd(t,o){o.status(400).json({err:t})}function capturePut(t,o){o.json(t.params)}var express=require("express"),app=express(),bodyParser=require("body-parser"),lib=require("./lib/lib"),dataFile=require("./provider/data"),data=dataFile,port=process.env.PORT||8e3,router=express.Router();app.use(bodyParser.urlencoded({extended:!0})),app.disable("x-powered-by"),app.use(bodyParser.json()),app.set("json spaces",2),router.route("/").get(function(t,o){o.json({message:"Welcome on flatplan_api !"})}),router.route("/produit/").get(function(t,o){o.json(data)}),router.route("/produit/:produit").get(function(t,o){lib.productIdx(t.params.produit).then(function(t){o.json(data[t])}).catch(function(t){return errEnd(t,o)})}).put(function(t,o){return capturePut(t,o)}),router.route("/produit/:produit/parution/").get(function(t,o){lib.productIdx(t.params.produit).then(function(t){o.json(data[t].parution)}).catch(function(t){return errEnd(t,o)})}),router.route("/produit/:produit/parution/:parution").get(function(t,o){lib.productParution(t).then(function(t){o.json(data[t.productIdx].parution[t.parutionIdx])}).catch(function(t){errEnd(t,o)})}).put(function(t,o){return capturePut(t,o)}),router.route("/produit/:produit/parution/:parution/folio").get(function(t,o){lib.productParution(t).then(function(t){o.json(data[t.productIdx].parution[t.parutionIdx].folio)}).catch(function(t){errEnd(t,o)})}),router.route("/produit/:produit/parution/:parution/folio/:folio").get(function(t,o){lib.productParutionFolio(t).then(function(t){o.json(data[t.productIdx].parution[t.parutionIdx].folio[t.folioIdx])}).catch(function(t){errEnd(t,o)})}).put(function(t,o){lib.productParutionFolio(t).then(function(r){data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx].page=t.params.folio,o.json(data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx])}).catch(function(t){errEnd(t)})}),router.route("/produit/:produit/parution/:parution/folio/:folio/status").get(function(t,o){lib.productParutionFolio(t).then(function(t){o.json(data[t.productIdx].parution[t.parutionIdx].folio[t.folioIdx].status)}).catch(function(t){errEnd(t,o)})}),router.route("/produit/:produit/parution/:parution/folio/:folio/status/:status").put(function(t,o){lib.productParutionFolio(t).then(function(r){var u=data[r.productIdx].parution[r.parutionIdx].folio[r.folioIdx].status;u=t.params.status,o.json(u)}).catch(function(t){errEnd(t)})}),app.use("/api",router),app.listen(port),module.exports=app;