<!DOCTYPE html>

<html>
<head>
  <title>BASE SETUP</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*jslint node: true */</span>
<span class="hljs-comment">/*jshint esversion: 6 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="base-setup">BASE SETUP</h1>
<p>call the packages we need</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>); <span class="hljs-comment">// call express</span>
<span class="hljs-keyword">const</span> app = express(); <span class="hljs-comment">// define our app using express</span>
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>configure app to use bodyParser()
this will let us get the data from a POST</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>app.use(bodyParser.urlencoded({
    <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>
}));
app.use(bodyParser.json());
app.set(<span class="hljs-string">'json spaces'</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> port = process.env.PORT || <span class="hljs-number">8e3</span>; <span class="hljs-comment">// set our port</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h1 id="routes-for-our-api">ROUTES FOR OUR API</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = express.Router(); <span class="hljs-comment">// get an instance of the express Router</span>
<span class="hljs-keyword">let</span> data = [{
    <span class="hljs-string">"produit"</span>: <span class="hljs-string">"ewe"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Les Echos Weekend"</span>,
    <span class="hljs-string">"parution"</span>: [{
        <span class="hljs-string">"parution"</span>: <span class="hljs-string">"20160101"</span>,
        <span class="hljs-string">"folio"</span>: [{
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"01"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }, {
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"02"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }]
    }, {
        <span class="hljs-string">"parution"</span>: <span class="hljs-string">"20160102"</span>,
        <span class="hljs-string">"folio"</span>: [{
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"01"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }, {
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"02"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }]
    }]
}, {
    <span class="hljs-string">"produit"</span>: <span class="hljs-string">"sli"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Serie Limitée"</span>,
    <span class="hljs-string">"parution"</span>: [{
        <span class="hljs-string">"parution"</span>: <span class="hljs-string">"20160101"</span>,
        <span class="hljs-string">"folio"</span>: [{
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"01"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }, {
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"02"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }]
    }, {
        <span class="hljs-string">"parution"</span>: <span class="hljs-string">"20160102"</span>,
        <span class="hljs-string">"folio"</span>: [{
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"01"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }, {
            <span class="hljs-string">"page"</span>: <span class="hljs-string">"02"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"locked"</span>,
            <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"bat"</span>
        }]
    }]
}];
<span class="hljs-keyword">let</span> productIdx = <span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>if (require.resolve(‘mongoose’)) reject(‘err : mongoose require ‘);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> idx = data.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.produit).indexOf(product)
        <span class="hljs-keyword">if</span> (idx &gt; <span class="hljs-number">0</span>) {
          resolve(idx);
        } <span class="hljs-keyword">else</span> {
          reject(idx);
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>test route to make sure everything is working (accessed at GET <a href="http://localhost:8080/api">http://localhost:8080/api</a>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
    res.json({
        <span class="hljs-attr">message</span>: <span class="hljs-string">'Welcome on flatplan_api !'</span>
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>res.redirect(‘<a href="https://www.youtube.com/watch?v=3Yfy_QIgpsc">https://www.youtube.com/watch?v=3Yfy_QIgpsc</a>‘);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>});
router.get(<span class="hljs-string">'/produit/'</span>, (req, res) =&gt; {
    res.json(data);
});
router.get(<span class="hljs-string">'/produit/:produit'</span>, (req, res) =&gt; {
    <span class="hljs-built_in">console</span>.log(productIdx(req.params.produit));</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>var idx = data.map((el) =&gt; el.produit).indexOf(req.params.produit);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    productIdx(req.params.produit).then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        res.json(data[result]);
    }, err =&gt; {
        res.end();
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {});
});
router.get(<span class="hljs-string">'/produit/:produit/parution/'</span>, (req, res) =&gt; {
    <span class="hljs-keyword">var</span> idx = data.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.produit).indexOf(req.params.produit);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>var idxparution= data[idxPro].map((el) =&gt; el.parution).indexOf(req.params.produit);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    res.json(data[idx].parution);
});
router.get(<span class="hljs-string">'/produit/:produit/parution/:parution'</span>, (req, res) =&gt; {
    <span class="hljs-built_in">console</span>.log(req.params);
    <span class="hljs-keyword">var</span> idx = data.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.produit).indexOf(req.params.produit);
    <span class="hljs-keyword">var</span> idxparution = data[idx].parution.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.parution).indexOf(req.params.parution);
    <span class="hljs-built_in">console</span>.log(idxparution);
    res.json(data[idx].parution[idxparution]);
});
router.get(<span class="hljs-string">'/produit/:produit/parution/:parution/folio'</span>, (req, res) =&gt; {
    <span class="hljs-built_in">console</span>.log(req.params);
    <span class="hljs-keyword">var</span> idx = data.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.produit).indexOf(req.params.produit);
    <span class="hljs-keyword">var</span> idxparution = data[idx].parution.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.parution).indexOf(req.params.parution);
    <span class="hljs-built_in">console</span>.log(idxparution);
    res.json(data[idx].parution[idxparution].folio);
});
router.get(<span class="hljs-string">'/produit/:produit/parution/:parution/folio/:folio'</span>, (req, res) =&gt; {
    <span class="hljs-built_in">console</span>.log(req.params);
    <span class="hljs-keyword">var</span> idx = data.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.produit).indexOf(req.params.produit);
    <span class="hljs-keyword">var</span> idxparution = data[idx].parution.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.parution).indexOf(req.params.parution);
    <span class="hljs-keyword">var</span> idxFolio = data[idx].parution[idxparution].folio.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.page).indexOf(<span class="hljs-built_in">Number</span>(req.params.folio));
    <span class="hljs-built_in">console</span>.log(idxFolio);
    res.json(data[idx].parution[idxparution].folio[idxFolio]);
});
router.get(<span class="hljs-string">'/produit/:produit/parution/:parution/folio/:folio/status'</span>, (req, res) =&gt; {
    <span class="hljs-built_in">console</span>.log(req.params);
    <span class="hljs-keyword">var</span> idx = data.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.produit).indexOf(req.params.produit);
    <span class="hljs-keyword">var</span> idxparution = data[idx].parution.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.parution).indexOf(req.params.parution);
    <span class="hljs-keyword">var</span> idxFolio = data[idx].parution[idxparution].folio.map(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.page).indexOf(<span class="hljs-built_in">Number</span>(req.params.folio));
    <span class="hljs-built_in">console</span>.log(idxFolio);
    res.json(data[idx].parution[idxparution].folio[idxFolio].status);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>more routes for our API will happen here
REGISTER OUR ROUTES ——————————-
all of our routes will be prefixed with /api</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>app.use(<span class="hljs-string">'/api'</span>, router);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h1 id="start-the-server">START THE SERVER</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>app.listen(port);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Magic happens on port '</span> + port);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>for debug support</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = app;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
