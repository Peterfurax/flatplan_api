<!DOCTYPE html>

<html>
<head>
  <title>INIT FILE SETUP</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="init-file-setup">INIT FILE SETUP</h1>
<ul>
<li>use strict option</li>
</ul>

          
            <div class='highlight'><pre><span class="hljs-meta">"use strict"</span>;</pre></div>
          
        

        
      </div>

      
        
        <ul>
<li>jslint option</li>
</ul>

        
          <div class='highlight'><pre><span class="hljs-comment">/*jslint node: true */</span>
<span class="hljs-comment">/*jshint esversion: 6 */</span></pre></div>
        
      
        
        <h1 id="require">REQUIRE</h1>
<ul>
<li>call the packages we need</li>
<li>must have to go !</li>
</ul>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = express();
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>);
<span class="hljs-keyword">const</span> dataFile = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./provider/data'</span>);
<span class="hljs-keyword">const</span> lib = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/lib'</span>);
<span class="hljs-keyword">const</span> data = dataFile;
<span class="hljs-keyword">const</span> port = process.env.PORT || <span class="hljs-number">8e3</span>;
<span class="hljs-keyword">const</span> router = express.Router();</pre></div>
        
      
        
        <ul>
<li>Configure <code>app</code> to use <code>bodyParser()</code></li>
</ul>

        
          <div class='highlight'><pre>app.use(bodyParser.urlencoded({
  <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>
}));</pre></div>
        
      
        
        <ul>
<li>Security disable x-powered-by</li>
</ul>

        
          <div class='highlight'><pre>app.disable(<span class="hljs-string">'x-powered-by'</span>);</pre></div>
        
      
        
        <ul>
<li>This will let us get the data from a POST</li>
</ul>

        
          <div class='highlight'><pre>app.use(bodyParser.json());</pre></div>
        
      
        
        <ul>
<li>Configure <code>app.set()</code> to indent json with 2 spaces in httpResponse</li>
</ul>

        
          <div class='highlight'><pre>app.set(<span class="hljs-string">'json spaces'</span>, <span class="hljs-number">2</span>);</pre></div>
        
      
        
        <h1 id="function">FUNCTION</h1>
<pre><code>errEnd(err, res);
</code></pre><p>return captured error to json httpResponse, status 400</p>
<ol>
<li>set Http status to <code>400</code> (bad request) =&gt; <code>res.status(codeNumber);</code></li>
<li>return a <code>json</code> with <code>err</code> =&gt; `res.json(err);``</li>
</ol>

        
          <div class='highlight'><pre><span class="hljs-comment">/**
 * @method errEnd
 * @param  {any}   err [captured error]
 * @param  {array} res [captured http res]
 * @return {json}      [return http json]
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errEnd</span>(<span class="hljs-params">err, res</span>) </span>{
  res.status(<span class="hljs-number">400</span>)
    .json({ <span class="hljs-string">"err"</span>: err });
}</pre></div>
        
      
        
        <p>TODO: capture all put
temp fonction</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">capturePut</span>(<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-built_in">console</span>.log(req.params);
  res.json(req.params);
}</pre></div>
        
      
        
        <h1 id="api-routes">API ROUTES</h1>
<ul>
<li>Here all the api route, get, post, put, delete</li>
</ul>
<h2 id="-">/</h2>
<ul>
<li><code>get</code></li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Welcome on flatplan_api !'</span> });
  });</pre></div>
        
      
        
        <h2 id="-produit-">/produit/</h2>
<ul>
<li><code>get</code></li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.json(data);
  });</pre></div>
        
      
        
        <h2 id="-produit-produit">/produit/:produit</h2>
<ul>
<li><code>get</code></li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productIdx(req.params.produit)
      .then(<span class="hljs-function"><span class="hljs-params">productIdx</span> =&gt;</span> {
        res.json(data[productIdx]);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> errEnd(err, res));
  })
  .put(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> capturePut(req, res));</pre></div>
        
      
        
        <h2 id="-produit-produit-parution-">/produit/:produit/parution/</h2>
<ul>
<li><code>get</code></li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit/parution/'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productIdx(req.params.produit)
      .then(<span class="hljs-function"><span class="hljs-params">productIdx</span> =&gt;</span> {
        res.json(data[productIdx].parution);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> errEnd(err, res));
  });</pre></div>
        
      
        
        <h2 id="-produit-produit-parution-parution">/produit/:produit/parution/:parution</h2>
<ul>
<li><code>get</code></li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit/parution/:parution'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productParution(req)
      .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        res.json(data[result.productIdx].parution[result.parutionIdx]);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { errEnd(err, res); });
  })
  .put(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> capturePut(req, res));</pre></div>
        
      
        
        <h2 id="-produit-produit-parution-parution-folio">/produit/:produit/parution/:parution/folio</h2>
<ul>
<li><code>get</code></li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit/parution/:parution/folio'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productParution(req)
      .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        res.json(data[result.productIdx].parution[result.parutionIdx].folio);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { errEnd(err, res); });
  });</pre></div>
        
      
        
        <h2 id="-produit-produit-parution-parution-folio-folio">/produit/:produit/parution/:parution/folio/:folio</h2>
<p>TODO: find good wa</p>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit/parution/:parution/folio/:folio'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productParutionFolio(req)
      .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        res.json(data[result.productIdx].parution[result.parutionIdx].folio[result.folioIdx]);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { errEnd(err, res); });
  })</pre></div>
        
      
        
        <ul>
<li><code>put</code> update folio</li>
</ul>

        
          <div class='highlight'><pre>  .put(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productParutionFolio(req)
      .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        data[result.productIdx].parution[result.parutionIdx].folio[result.folioIdx].page = req.params.folio;
        res.json(data[result.productIdx].parution[result.parutionIdx].folio[result.folioIdx]);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { errEnd(err); });
  });</pre></div>
        
      
        
        <h2 id="-produit-produit-parution-parution-folio-folio-status">/produit/:produit/parution/:parution/folio/:folio/status</h2>
<ul>
<li><code>get</code> status of folio</li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit/parution/:parution/folio/:folio/status'</span>)
  .get(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productParutionFolio(req)
      .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        res.json(data[result.productIdx].parution[result.parutionIdx].folio[result.folioIdx].status);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { errEnd(err, res); });
  });</pre></div>
        
      
        
        <h2 id="-produit-produit-parution-parution-folio-folio-status-status">/produit/:produit/parution/:parution/folio/:folio/status/:status</h2>
<ul>
<li><code>put</code> update status false === locked or true === unlocked</li>
</ul>

        
          <div class='highlight'><pre>router.route(<span class="hljs-string">'/produit/:produit/parution/:parution/folio/:folio/status/:status'</span>)
  .put(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    lib.productParutionFolio(req)
      .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        data[result.productIdx].parution[result.parutionIdx].folio[result.folioIdx].status = req.params.status;
        res.json(data[result.productIdx].parution[result.parutionIdx].folio[result.folioIdx].status);
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { errEnd(err); });
  });</pre></div>
        
      
        
        <h1 id="register-route">REGISTER ROUTE</h1>
<p>all routes will be prefixed with /api</p>

        
          <div class='highlight'><pre>app.use(<span class="hljs-string">'/api'</span>, router);</pre></div>
        
      
        
        <h1 id="start-the-server">START THE SERVER</h1>
<p>express.listen port, up httpServer</p>

        
          <div class='highlight'><pre>app.listen(port);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Magic happens on port '</span> + port);</pre></div>
        
      
        
        <h1 id="debug-support">DEBUG SUPPORT</h1>

        
          <div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = app;</pre></div>
        
      
        
        <p>easter eggs
router.route(‘/eggs’, (req, res) =&gt; {
 res.redirect(‘<a href="https://www.youtube.com/watch?v=3Yfy_QIgpsc">https://www.youtube.com/watch?v=3Yfy_QIgpsc</a>‘);
});</p>

        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
